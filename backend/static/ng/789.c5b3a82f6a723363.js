"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[789],{9789:($e,U,l)=>{l.r(U),l.d(U,{SettingsModule:()=>je});var E=l(2480),v=l(1728),b=l(9114),y=l(430),D=l(8097),e=l(2223),x=l(1217),h=(l(706),l(1692),l(418),l(9401)),g=l(4755);let te=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[x.BQ,g.ez,x.si,x.BQ]}),i})();var R=l(787),oe=l(877),C=l(2214),k=l(5580),ie=l(7775),re=l(4466),A=l(7579),T=l(2722),ae=l(4880),ne=l(4709),ce=l(4485),I=l(1683),q=l(3189),S=l(3332);function se(i,a){1&i&&(e.ynx(0),e._uU(1,"Create User"),e.BQk())}function de(i,a){1&i&&(e.ynx(0),e._uU(1,"Edit User"),e.BQk())}function le(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Email is required. "),e.qZA())}function me(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Email format error. "),e.qZA())}function ue(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," User Name is required. "),e.qZA())}function pe(i,a){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",25)(2,"div",26),e._uU(3),e.qZA(),e.TgZ(4,"div",27),e._uU(5),e.qZA()(),e.BQk()),2&i){const t=a.$implicit;e.xp6(1),e.Q6J("value",t.value),e.xp6(2),e.Oqu(t.label),e.xp6(2),e.Oqu(t.description)}}function _e(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Password is required. "),e.qZA())}function ge(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Password confirmation is required. "),e.qZA())}function fe(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Passwords must match "),e.qZA())}function he(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"button",28),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onDelete())}),e._UZ(1,"mat-icon",29),e.qZA()}2&i&&(e.xp6(1),e.Q6J("svgIcon","heroicons_outline:trash"))}let be=(()=>{class i{constructor(t,o,r,c,n,_,m){this._data=t,this._changeDetectorRef=o,this._formBuilder=r,this._matDialogRef=c,this._fuseConfirmationService=n,this._alert=_,this._settingService=m}ngOnInit(){this.user=this._data.user,this.user.is_staff||(this.user.is_staff=!1),this.roles=[{label:"User",value:!1},{label:"Admin",value:!0}],this.form=this._formBuilder.group({username:[this.user.username,[h.kI.required]],email:[this.user.email,[h.kI.required,h.kI.email]],is_staff:[this.user.is_staff],password:[""],password2:[""]},{validators:ce.a.mustMatch("password","password2")}),this.user.id||(this.form.get("password").setValidators([h.kI.required]),this.form.get("password2").setValidators([h.kI.required]),this.form.get("password").updateValueAndValidity(),this.form.get("password2").updateValueAndValidity())}onSave(){let t;this.form.invalid||(this.user.id?(t={id:this.user.id,username:this.form.get("username").value,email:this.form.get("email").value,is_staff:this.form.get("is_staff").value},this.form.get("password").value&&(t.password=this.form.get("password").value),this._settingService.updateUser(t).subscribe({next:o=>{o&&(this._alert.open({message:"The user has been created."}),this._matDialogRef.close())},error:o=>{console.log(o);let r=JSON.stringify(o.message);o.error&&(r=o.error),this._fuseConfirmationService.open({icon:{color:"warn"},title:"Error",message:r,actions:{confirm:{label:"Done",color:"primary"},cancel:{show:!1}}})}})):(t=this.form.value,this._settingService.createUser(this.form.value).subscribe({next:o=>{o&&(this._alert.open({message:"The user has been created."}),this._matDialogRef.close())},error:o=>{console.log(o);let r=JSON.stringify(o.message);o.error&&(r=JSON.stringify(o.error)),this._fuseConfirmationService.open({icon:{color:"warn"},title:"Error",message:r,actions:{confirm:{label:"Done",color:"primary"},cancel:{show:!1}}})}})))}onDelete(){this._fuseConfirmationService.open({message:"Are you sure to delete?",icon:{color:"warn"},actions:{confirm:{label:"Delete",color:"warn"}}}).afterClosed().subscribe(o=>{"confirmed"===o&&(this.delete(),this._changeDetectorRef.markForCheck())})}delete(){this._settingService.deleteUser(this.user.id).subscribe({next:t=>{this._alert.open({message:"The user has been deleted."}),this._matDialogRef.close()},error:t=>{console.log(t);let o=JSON.stringify(t.message);t.error&&(o=t.error),this._fuseConfirmationService.open({icon:{color:"warn"},title:"Error",message:o,actions:{confirm:{label:"Done",color:"primary"},cancel:{show:!1}}})}})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(k.WI),e.Y36(e.sBO),e.Y36(h.QS),e.Y36(k.so),e.Y36(I.R),e.Y36(q.c),e.Y36(S.g))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-dialog"]],decls:52,vars:23,consts:[[1,"flex","flex-col","min-w-72","flex-auto","md:w-160","md:min-w-160","-m-6"],[1,"m-8"],[3,"formGroup"],[1,"w-full","text-2xl"],[4,"ngIf"],[1,"mt-6"],[1,"w-full","fuse-mat-dense"],["matPrefix","",1,"hidden","sm:flex","icon-size-5",3,"svgIcon"],["matInput","",3,"formControlName"],[1,"mt-1"],[1,"flex"],[1,"flex-auto","w-full","fuse-mat-dense"],["matInput","",3,"formControlName","spellcheck"],[1,"flex-auto","w-full","max-w-24","sm:max-w-40","ml-2","sm:ml-4","fuse-mat-dense"],["disableOptionCentering","",3,"panelClass","formControlName"],["roleSelect","matSelect"],[4,"ngFor","ngForOf"],[1,"flex-1","fuse-mat-dense"],["type","password","matInput","","autocomplete","password",3,"formControlName"],[1,"flex-1","w-full","ml-2","sm:ml-4","fuse-mat-dense"],[1,"flex","items-center","justify-between","mt-4","mb-2"],[1,"flex","items-center","space-x-2"],["type","button","mat-icon-button","",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",1,"bg-accent","mr-2",3,"click"],["mat-flat-button","","matDialogClose",""],[1,"h-auto","py-4","leading-none",3,"value"],[1,"font-medium"],[1,"mt-1.5","text-sm","whitespace-normal","leading-normal","text-secondary"],["type","button","mat-icon-button","",3,"click"],[3,"svgIcon"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"form",2)(3,"div")(4,"span",3),e.YNc(5,se,2,0,"ng-container",4),e.YNc(6,de,2,0,"ng-container",4),e.qZA()(),e.TgZ(7,"div",5)(8,"mat-form-field",6)(9,"mat-label"),e._uU(10,"Email"),e.qZA(),e._UZ(11,"mat-icon",7)(12,"input",8),e.YNc(13,le,2,0,"mat-error",4),e.YNc(14,me,2,0,"mat-error",4),e.qZA()(),e.TgZ(15,"div",9)(16,"div",10)(17,"mat-form-field",11)(18,"mat-label"),e._uU(19,"User Name"),e.qZA(),e._UZ(20,"mat-icon",7)(21,"input",12),e.YNc(22,ue,2,0,"mat-error",4),e.qZA(),e.TgZ(23,"mat-form-field",13)(24,"mat-label"),e._uU(25),e.qZA(),e.TgZ(26,"mat-select",14,15),e.YNc(28,pe,6,3,"ng-container",16),e.qZA()()()(),e.TgZ(29,"div",9)(30,"div",10)(31,"mat-form-field",17)(32,"mat-label"),e._uU(33,"Password"),e.qZA(),e._UZ(34,"mat-icon",7)(35,"input",18),e.YNc(36,_e,2,0,"mat-error",4),e.qZA(),e.TgZ(37,"mat-form-field",19)(38,"mat-label"),e._uU(39,"Password (Confirm)"),e.qZA(),e._UZ(40,"mat-icon",7)(41,"input",18),e.YNc(42,ge,2,0,"mat-error",4),e.YNc(43,fe,2,0,"mat-error",4),e.qZA()()(),e.TgZ(44,"div",20)(45,"div",21),e.YNc(46,he,2,1,"button",22),e.qZA(),e.TgZ(47,"div")(48,"button",23),e.NdJ("click",function(){return o.onSave()}),e._uU(49,"Save"),e.qZA(),e.TgZ(50,"button",24),e._uU(51,"Close"),e.qZA()()()()()()),2&t&&(e.xp6(2),e.Q6J("formGroup",o.form),e.xp6(3),e.Q6J("ngIf",!o.user.id),e.xp6(1),e.Q6J("ngIf",o.user.id),e.xp6(5),e.Q6J("svgIcon","heroicons_solid:mail"),e.xp6(1),e.Q6J("formControlName","email"),e.xp6(1),e.Q6J("ngIf",o.form.get("email").hasError("required")),e.xp6(1),e.Q6J("ngIf",o.form.get("email").hasError("email")),e.xp6(6),e.Q6J("svgIcon","heroicons_solid:user-circle"),e.xp6(1),e.Q6J("formControlName","username")("spellcheck",!1),e.xp6(1),e.Q6J("ngIf",o.form.get("username").hasError("required")),e.xp6(3),e.hij("Role ",o.user.is_staff,""),e.xp6(1),e.Q6J("panelClass","h-auto max-h-none")("formControlName","is_staff"),e.xp6(2),e.Q6J("ngForOf",o.roles),e.xp6(6),e.Q6J("svgIcon","heroicons_solid:key"),e.xp6(1),e.Q6J("formControlName","password"),e.xp6(1),e.Q6J("ngIf",o.form.get("password").hasError("required")),e.xp6(4),e.Q6J("svgIcon","heroicons_solid:key"),e.xp6(1),e.Q6J("formControlName","password2"),e.xp6(1),e.Q6J("ngIf",o.form.get("password2").hasError("required")),e.xp6(1),e.Q6J("ngIf",o.form.get("password2").hasError("mustMatch")),e.xp6(3),e.Q6J("ngIf",o.user.id))},dependencies:[v.lW,v.RK,b.KE,b.hX,b.TO,b.qo,y.Hw,D.Nt,R.gD,x.ey,k.ZT,g.sg,g.O5,h._Y,h.Fj,h.JJ,h.JL,h.sg,h.u],encapsulation:2,changeDetection:0}),i})();const ve=function(i){return{"text-blue-500 font-semibold":i}};function xe(i,a){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",9)(2,"div",10)(3,"div",11),e.ynx(4),e.TgZ(5,"div",12),e._uU(6),e.qZA(),e.BQk(),e.qZA(),e.TgZ(7,"div",13)(8,"div",14),e._uU(9),e.qZA(),e.TgZ(10,"div",15),e._uU(11),e.qZA()()(),e.TgZ(12,"div",16)(13,"div",17)(14,"div",14),e._uU(15,"Date Joined"),e.qZA(),e.TgZ(16,"div",15),e._uU(17),e.ALo(18,"date"),e.qZA()()(),e.TgZ(19,"div",16)(20,"div",17)(21,"div",14),e._uU(22,"Role"),e.qZA(),e.TgZ(23,"div",18),e._uU(24),e.qZA()()(),e.TgZ(25,"div",19)(26,"div",20)(27,"button",21),e.NdJ("click",function(){const c=e.CHM(t).$implicit,n=e.oxw(2);return e.KtG(n.openDialog(c))}),e._UZ(28,"mat-icon",22),e.qZA()()()(),e.BQk()}if(2&i){const t=a.$implicit;e.xp6(6),e.hij(" ",t.username.charAt(0)," "),e.xp6(3),e.Oqu(t.email),e.xp6(2),e.Oqu(t.username),e.xp6(6),e.Oqu(e.xi3(18,7,t.date_joined,"yyyy/MM/dd HH:mm:ss")),e.xp6(6),e.Q6J("ngClass",e.VKq(10,ve,t.is_staff)),e.xp6(1),e.hij(" ",t.is_staff?"Admin":"User",""),e.xp6(4),e.Q6J("svgIcon","heroicons_outline:pencil-alt")}}function ye(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",1)(1,"div",2),e._UZ(2,"div",3),e.TgZ(3,"button",4),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.openDialog())}),e._UZ(4,"mat-icon",5),e.TgZ(5,"span",6),e._uU(6,"Create"),e.qZA()()(),e.TgZ(7,"div",7),e.YNc(8,xe,29,12,"ng-container",8),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("color","primary"),e.xp6(1),e.Q6J("svgIcon","heroicons_solid:plus-circle"),e.xp6(4),e.Q6J("ngForOf",t.users)("ngForTrackBy",t.trackByFn)}}let we=(()=>{class i{constructor(t,o,r,c,n){this._changeDetectorRef=t,this._matDialog=o,this._fuseConfirmationService=r,this._alert=c,this._settingService=n,this._unsubscribeAll=new A.x,this.users=null}ngOnInit(){this._settingService.users$.pipe((0,T.R)(this._unsubscribeAll)).subscribe(t=>{this.users=t,this._changeDetectorRef.markForCheck()}),this.roles=[{label:"User",value:!1},{label:"Admin",value:!0}],this.members=[{avatar:"assets/images/avatars/male-01.jpg",name:"Dejesus Michael",email:"dejesusmichael@mail.org",role:"admin"},{avatar:"assets/images/avatars/male-03.jpg",name:"Mclaughlin Steele",email:"mclaughlinsteele@mail.me",role:"admin"},{avatar:"assets/images/avatars/female-02.jpg",name:"Laverne Dodson",email:"lavernedodson@mail.ca",role:"write"},{avatar:"assets/images/avatars/female-03.jpg",name:"Trudy Berg",email:"trudyberg@mail.us",role:"read"},{avatar:"assets/images/avatars/male-07.jpg",name:"Lamb Underwood",email:"lambunderwood@mail.me",role:"read"},{avatar:"assets/images/avatars/male-08.jpg",name:"Mcleod Wagner",email:"mcleodwagner@mail.biz",role:"read"},{avatar:"assets/images/avatars/female-07.jpg",name:"Shannon Kennedy",email:"shannonkennedy@mail.ca",role:"read"}]}openDialog(t={}){this._matDialog.open(be,{autoFocus:!1,data:{user:t}})}trackByFn(t,o){return o.id||t}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO),e.Y36(k.uw),e.Y36(I.R),e.Y36(q.c),e.Y36(S.g))},i.\u0275cmp=e.Xpm({type:i,selectors:[["settings-account"]],decls:1,vars:1,consts:[["class","w-full max-w-5xl",4,"ngIf"],[1,"w-full","max-w-5xl"],[1,"flex","items-center"],[1,"flex","items-center","flex-auto"],["mat-flat-button","",1,"ml-4","px-1","sm:px-4","min-w-10","bg-accent",3,"color","click"],[1,"icon-size-5",3,"svgIcon"],[1,"hidden","sm:inline-block","ml-2"],[1,"flex","flex-col","mt-8","divide-y","border-t","border-b"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","flex-col","sm:flex-row","sm:items-center","py-6"],[1,"flex","items-center","sm:w-full"],[1,"flex","flex-0","items-center","justify-center","w-10","h-10","rounded-full","overflow-hidden"],[1,"flex","items-center","justify-center","w-full","h-full","rounded-full","text-lg","uppercase","bg-gray-200","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"ml-4"],[1,"font-medium"],[1,"text-secondary"],[1,"flex","items-center","mt-4","sm:mt-0","sm:w-1/2"],[1,"order-2","sm:order-1","ml-4","sm:ml-0"],[1,"text-secondary",3,"ngClass"],[1,"flex","items-center","mt-4","sm:mt-0","sm:ml-auto"],[1,"order-2","sm:order-2","sm:ml-16"],["mat-icon-button","",3,"click"],[1,"text-hint",3,"svgIcon"]],template:function(t,o){1&t&&e.YNc(0,ye,9,4,"div",0),2&t&&e.Q6J("ngIf",o.users)},dependencies:[v.lW,v.RK,y.Hw,g.mk,g.sg,g.O5,g.uU],encapsulation:2,changeDetection:0}),i})();function Q(i,a,t,o,r,c,n){try{var _=i[c](n),m=_.value}catch(s){return void t(s)}_.done?a(m):Promise.resolve(m).then(o,r)}function N(i){return function(){var a=this,t=arguments;return new Promise(function(o,r){var c=i.apply(a,t);function n(m){Q(c,o,r,n,_,"next",m)}function _(m){Q(c,o,r,n,_,"throw",m)}n(void 0)})}}var M=l(4313),B=l(4327);function ke(i,a){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",17),e._uU(2),e.qZA(),e.BQk()),2&i){const t=a.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function Te(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onSave())}),e._UZ(1,"mat-icon",18),e.TgZ(2,"span",9),e._uU(3,"Save"),e.qZA()()}2&i&&e.Q6J("color","basic")}function Ze(i,a){if(1&i&&(e.TgZ(0,"td",21),e._uU(1),e.qZA()),2&i){const t=e.oxw(2).$implicit;e.Q6J("rowSpan",null==t.test_items?null:t.test_items.length),e.xp6(1),e.Oqu(t.name)}}function Ce(i,a){1&i&&(e.ynx(0),e._UZ(1,"td"),e.BQk())}function Ae(i,a){if(1&i&&(e.ynx(0),e.TgZ(1,"td",20),e._uU(2),e.qZA(),e.YNc(3,Ce,2,0,"ng-container",16),e.BQk()),2&i){const t=e.oxw().$implicit,o=e.oxw().$implicit;e.xp6(2),e.Oqu(t.amount),e.xp6(1),e.Q6J("ngIf",1==o.fee.length)}}function Ie(i,a){if(1&i&&(e.ynx(0),e.TgZ(1,"td",20),e._uU(2),e.qZA(),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(2),e.Oqu(t.amount)}}function qe(i,a){if(1&i&&(e.ynx(0),e._UZ(1,"td"),e.TgZ(2,"td",20),e._uU(3),e.qZA(),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(3),e.Oqu(t.amount)}}function Se(i,a){if(1&i&&(e.ynx(0),e.YNc(1,Ae,4,2,"ng-container",16),e.YNc(2,Ie,3,1,"ng-container",16),e.YNc(3,qe,4,1,"ng-container",16),e.BQk()),2&i){const t=a.$implicit,o=a.index;e.xp6(1),e.Q6J("ngIf","2K"===t.chamber&&0==o),e.xp6(1),e.Q6J("ngIf","WALKIN"===t.chamber&&1==o),e.xp6(1),e.Q6J("ngIf","WALKIN"===t.chamber&&0==o)}}function De(i,a){if(1&i&&(e.ynx(0),e.TgZ(1,"tr"),e.YNc(2,Ze,2,2,"td",19),e.TgZ(3,"td",20),e._uU(4),e.qZA(),e.TgZ(5,"td",20),e._uU(6),e.qZA(),e.YNc(7,Se,4,3,"ng-container",5),e.qZA(),e.BQk()),2&i){const t=a.$implicit,o=a.index;e.xp6(2),e.Q6J("ngIf",0==o),e.xp6(2),e.Oqu(t.item_name),e.xp6(2),e.Oqu(t.lab_location),e.xp6(1),e.Q6J("ngForOf",t.fee)}}function Re(i,a){if(1&i&&(e.ynx(0),e.YNc(1,De,8,4,"ng-container",5),e._UZ(2,"tr"),e.BQk()),2&i){const t=a.$implicit;e.xp6(1),e.Q6J("ngForOf",t.test_items)}}function Ue(i,a){if(1&i&&(e.TgZ(0,"tbody"),e.YNc(1,Re,3,1,"ng-container",5),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",null==t.page.data?null:t.page.data.functions)}}let Fe=(()=>{class i{constructor(t,o,r,c){this._changeDetectorRef=t,this._fuseConfirmationService=o,this._alert=r,this._settingService=c,this._unsubscribeAll=new A.x,this.existingItems=null,this.currentYear=(new Date).getFullYear(),this.page={customers:null,customer:null,data:null}}ngOnInit(){this._settingService.customers$.pipe((0,T.R)(this._unsubscribeAll)).subscribe(t=>{t&&t.length>0&&(this.page.customers=t,this.page.customer=t[0].id,this.page.data=JSON.parse(JSON.stringify(t[0])),this._changeDetectorRef.markForCheck())})}onSelectionChange(t){this.page.data=JSON.parse(JSON.stringify(this.page.customers.find(o=>o.id===t)))}change(){}onImport(){const t=document.createElement("input");t.type="file",t.accept=".xlsx,.xls",t.click(),t.addEventListener("change",o=>{const r=o.target.files[0];r&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===r.type?this.readExcel(r):this._alert.open({type:"warn",message:"Please select a valid Excel file."})})}readExcel(t){var o=this;return N(function*(){try{const r=new M.Workbook;yield r.xlsx.load(t);let n=[];r.worksheets[0].eachRow((s,d)=>{const u=[];s.eachCell({includeEmpty:!0},(p,Z)=>{let f=p.value;f&&f.richText&&(f=p.text),"string"==typeof f&&(f=f.replace(/\r\n$/,"").trim()),u.push(f)}),n.push(u)});const _=s=>n.every(d=>null===d[s]);if(n=n.map(s=>s.filter((d,u)=>!_(u))),0===n.length)return void o._alert.open({type:"warn",message:"The Excel has no data."});if("Reliability/S&V Test"===n[0][0])return void o._alert.open({type:"warn",message:"Cannot find customer."});if("Reliability/S&V Test"!==n[1][0])return void o._alert.open({type:"warn",duration:5,message:"The format of the Excel data is wrong, please confirm whether the correct template is used."});o.page.data={name:n[0][0],functions:[]};let m=[];for(let s=3;s<n.length;s++){const d=n[s];let u=o.page.data.functions.find(p=>p.name===d[0]);u?u.test_items.push({item_name:d[1],lab_location:d[2]?d[2].toUpperCase():null,chamber:d[3]?d[3].toUpperCase():"2K",fee:d[4]??0,order:s}):o.page.data.functions.push({name:d[0],test_items:[{item_name:d[1],lab_location:d[2]?d[2].toUpperCase():null,chamber:d[3]?d[3].toUpperCase():"2K",fee:d[4]??0,order:s}]}),m.push({no:d[1].split(" ")[0],item_name:d[1]})}o.existingItems=[],m.reduceRight((s,d)=>{let u=s.find(p=>p.no===d.no);if(u){let p=o.existingItems.find(Z=>Z.no===u.no);p?p.count++:o.existingItems.push({no:u.no,count:1})}else s.unshift(d);return s},[]),o.save(o.page.data)}catch{o._alert.open({type:"warn",duration:5,message:"The format of the Excel data is wrong, please confirm whether the correct template is used."})}})()}onSave(){this.save(this.page.data)}save(t){this._settingService.saveCustomers(t).subscribe({next:o=>{let r=o.data,c=null;if(this.page.customers?c=this.page.customers.find(n=>n.name==r.name&&n.id==r.id):this.page.customers=[],c?Object.assign(c,r):(this.page.customers.push(r),c=this.page.customers[this.page.customers.length-1]),this._settingService.customers=this.page.customers,this.page.customer=c.id,this.page.data=r,this.existingItems.length>0){let n="";for(let m of this.existingItems)n+=`${m.no}&emsp; \u91cd\u8907: ${m.count}<br/>`;if(o.not_exist_items.length>0){n+="<br/>\u7121\u6cd5\u5c0d\u61c9\u9805\u76ee:<br/>";for(let m of o.not_exist_items)n+=`${m.no}\u3001`}this._fuseConfirmationService.open({title:"Info",message:n,icon:{color:"info"},actions:{confirm:{color:"primary",label:"Continue"},cancel:{show:!1}}}).afterClosed().subscribe(m=>{"confirmed"===m&&(this._alert.open({message:"Upload completed."}),this._changeDetectorRef.markForCheck())})}},error:o=>{console.log(o),this._fuseConfirmationService.open({title:"Error",message:JSON.stringify(o.message),actions:{confirm:{color:"warn",label:"OK"},cancel:{show:!1}}})}})}onDownload(){const t="nre_3rd_fee_template.xlsx";fetch("assets/excel/"+t).then(r=>r.blob()).then(r=>{B.saveAs(r,t)})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO),e.Y36(I.R),e.Y36(q.c),e.Y36(S.g))},i.\u0275cmp=e.Xpm({type:i,selectors:[["test-fee"]],decls:40,vars:10,consts:[[1,"w-full"],[1,"flex","flex-auto"],[1,"flex"],[1,"w-full","sm:w-40","fuse-mat-dense"],[3,"placeholder","value","valueChange","selectionChange"],[4,"ngFor","ngForOf"],["matPrefix","","fontSet","material-icons-outlined"],["mat-flat-button","",1,"ml-3",3,"color","click"],[1,"icon-size-5","text-black",3,"svgIcon"],[1,"ml-2","mr-1"],[1,"ml-auto"],["class","ml-3","mat-flat-button","",3,"color","click",4,"ngIf"],[1,"fee-table"],["colspan","5"],["rowspan","2"],["colspan","2"],[4,"ngIf"],[3,"value"],["fontIcon","save"],["class","text-center w-32",3,"rowSpan",4,"ngIf"],[1,"px-2"],[1,"text-center","w-32",3,"rowSpan"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-form-field",3)(4,"mat-select",4),e.NdJ("valueChange",function(c){return o.page.customer=c})("selectionChange",function(c){return o.onSelectionChange(c.value)}),e.YNc(5,ke,3,2,"ng-container",5),e.qZA(),e.TgZ(6,"mat-icon",6),e._uU(7,"supervisor_account"),e.qZA()()(),e.TgZ(8,"div")(9,"button",7),e.NdJ("click",function(){return o.onDownload()}),e._UZ(10,"mat-icon",8),e.TgZ(11,"span",9),e._uU(12,"Download Template"),e.qZA()()(),e.TgZ(13,"div",10)(14,"button",7),e.NdJ("click",function(){return o.onImport()}),e._UZ(15,"mat-icon",8),e.TgZ(16,"span",9),e._uU(17,"Import"),e.qZA()()(),e.TgZ(18,"div"),e.YNc(19,Te,4,1,"button",11),e.qZA()(),e.TgZ(20,"table",12)(21,"thead")(22,"tr")(23,"th",13),e._uU(24,"Reliability/S&V Test"),e.qZA()(),e.TgZ(25,"tr")(26,"th",14),e._uU(27,"Function"),e.qZA(),e.TgZ(28,"th",14),e._uU(29,"Test Item"),e.qZA(),e.TgZ(30,"th",14),e._uU(31,"Lab Location"),e.qZA(),e.TgZ(32,"th",15),e._uU(33),e.qZA()(),e.TgZ(34,"tr")(35,"th"),e._uU(36,"2K"),e.qZA(),e.TgZ(37,"th"),e._uU(38,"Walk-in"),e.qZA()()(),e.YNc(39,Ue,2,1,"tbody",16),e.qZA()()),2&t&&(e.xp6(4),e.Q6J("placeholder","Customer")("value",o.page.customer),e.xp6(1),e.Q6J("ngForOf",o.page.customers),e.xp6(4),e.Q6J("color","basic"),e.xp6(1),e.Q6J("svgIcon","heroicons_outline:arrow-down-tray"),e.xp6(4),e.Q6J("color","basic"),e.xp6(1),e.Q6J("svgIcon","heroicons_outline:arrow-up-tray"),e.xp6(4),e.Q6J("ngIf",o.page.data&&o.page.data.length>0),e.xp6(14),e.Oqu(o.currentYear),e.xp6(6),e.Q6J("ngIf",o.page.data))},dependencies:[v.lW,b.KE,b.qo,y.Hw,R.gD,x.ey,g.sg,g.O5],styles:["table.fee-table{width:100%;table-layout:auto;border-left-width:1px;--tw-border-opacity: 1;border-color:rgb(100 116 139 / var(--tw-border-opacity));border-collapse:separate;border-spacing:0}table.fee-table thead{position:sticky;top:0;--tw-bg-opacity: 1;background-color:rgb(248 250 252 / var(--tw-bg-opacity))}table.fee-table th{border-right-width:1px;border-bottom-width:1px;--tw-border-opacity: 1;border-color:rgb(100 116 139 / var(--tw-border-opacity));padding:.125rem}table.fee-table tr:first-child th{border-top-width:1px}table.fee-table td{border-bottom-width:1px;border-right-width:1px;--tw-border-opacity: 1;border-color:rgb(100 116 139 / var(--tw-border-opacity));padding:.125rem}table.fee-table td .checkbox{margin-top:.25rem;height:1rem;width:1rem}table.fee-table .edit{width:4.5rem;white-space:nowrap;--tw-bg-opacity: 1;background-color:rgb(219 234 254 / var(--tw-bg-opacity));text-align:center}table.fee-table .edit input{width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-align:center}table.fee-table .view{text-align:center}\n"],encapsulation:2,changeDetection:0}),i})();function Je(i,a){if(1&i&&(e.ynx(0),e.TgZ(1,"tr")(2,"td",13),e._uU(3),e.qZA(),e.TgZ(4,"td",16),e._uU(5),e.qZA(),e.TgZ(6,"td",16),e._uU(7),e.qZA(),e.TgZ(8,"td",16),e._uU(9),e.qZA(),e.TgZ(10,"td",16),e._uU(11),e.qZA()(),e.BQk()),2&i){const t=a.$implicit,o=a.index;e.xp6(3),e.Oqu(o+1),e.xp6(2),e.Oqu(t.no),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.man_working_hours),e.xp6(2),e.Oqu(t.equip_working_hours)}}function Oe(i,a){if(1&i&&(e.TgZ(0,"tbody"),e.YNc(1,Je,12,5,"ng-container",15),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.page.data)}}let Qe=(()=>{class i{constructor(t,o,r,c,n){this._formBuilder=t,this._changeDetectorRef=o,this._fuseConfirmationService=r,this._settingsService=c,this._alert=n,this._unsubscribeAll=new A.x,this.elementPattern=null,this.page={items:null,data:null}}ngOnInit(){this._settingsService.items$.pipe((0,T.R)(this._unsubscribeAll)).subscribe(t=>{t&&(this.page.items=t,this.elementPattern=t[0],this.page.data=JSON.parse(JSON.stringify(t)),this._changeDetectorRef.markForCheck())})}onSearch(t){this._settingsService.queryItems({query:t}).pipe((0,T.R)(this._unsubscribeAll)).subscribe(o=>{o&&(this.page.data=JSON.parse(JSON.stringify(o)),this._changeDetectorRef.markForCheck())})}onImport(){const t=document.createElement("input");t.type="file",t.accept=".xlsx,.xls",t.click(),t.addEventListener("change",o=>{const r=o.target.files[0];r&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===r.type?this.readExcel(r):this._alert.open({type:"warn",message:"Please select a valid Excel file."})})}readExcel(t){var o=this;return N(function*(){try{const r=new M.Workbook;yield r.xlsx.load(t);let n=[];r.worksheets[0].eachRow((s,d)=>{const u=[];s.eachCell({includeEmpty:!0},(p,Z)=>{let f=p.value;f&&f.richText&&(f=p.text),"string"==typeof f&&(f=f.replace(/\r\n$/,"").trim()),u.push(f)}),n.push(u)});const _=s=>n.every(d=>null===d[s]);if(n=n.map(s=>s.filter((d,u)=>!_(u))),0===n.length)return void o._alert.open({type:"warn",message:"The Excel has no data."});if("Enterprise Reliability Test Procedures"!==n[0][1])return void o._alert.open({type:"warn",duration:5,message:"The format of the Excel data is wrong, please confirm whether the correct template is used."});o.page.data=[];for(let s=0;s<n.length;s++){const d=n[s];s>1&&o.page.data.push({no:d[1].split(" ")[0],name:d[1],man_working_hours:parseFloat(d[2]).toFixed(2),equip_working_hours:parseFloat(d[3]).toFixed(2),order:s})}let m=[];if(o.page.data=o.page.data.reduceRight((s,d)=>{const u=s.find(p=>p.no===d.no);if(u){let p=m.find(Z=>Z.no===u.no);p?p.count++:m.push({no:u.no,count:1})}else s.unshift(d);return s},[]),m.length>0){let s="";for(let u of m)s+=`${u.no}&emsp; \u91cd\u8907: ${u.count}<br/>`;o._fuseConfirmationService.open({title:"Info",message:s,icon:{color:"info"},actions:{confirm:{color:"primary",label:"Continue"},cancel:{show:!1}}}).afterClosed().subscribe(u=>{"confirmed"===u&&o.save(o.page.data)})}else o.save(o.page.data)}catch{o._alert.open({type:"warn",duration:5,message:"The format of the Excel data is wrong, please confirm whether the correct template is used."})}})()}onChange(){}onDownload(){const t="nre_test_item_template.xlsx";fetch("assets/excel/"+t).then(r=>r.blob()).then(r=>{B.saveAs(r,t)})}onAdd(){let t={};for(let o in this.elementPattern)"id"!==o&&(t[o]=null);this.page.data.unshift(t)}onSave(){this.save(this.page.data)}save(t){this._settingsService.saveItems(t).subscribe({next:o=>{this.page.data=o,this._settingsService.items=o,this._alert.open({message:"Upload completed."}),this._changeDetectorRef.markForCheck()},error:o=>{console.log(o),this._fuseConfirmationService.open({title:"Error",message:JSON.stringify(o.message),actions:{confirm:{color:"warn",label:"OK"},cancel:{show:!1}}})}})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.QS),e.Y36(e.sBO),e.Y36(I.R),e.Y36(S.g),e.Y36(q.c))},i.\u0275cmp=e.Xpm({type:i,selectors:[["default-items"]],decls:38,vars:7,consts:[[1,"w-full"],[1,"flex","flex-auto"],[1,"flex"],[1,"w-full","sm:w-80","fuse-mat-dense"],["matPrefix","","fontSet","material-icons-outlined"],["type","search","matInput","",3,"autocomplete","placeholder","keyup.enter"],["mat-flat-button","",1,"ml-3",3,"color","click"],[1,"icon-size-5","text-black",3,"svgIcon"],[1,"ml-2","mr-1"],[1,"ml-auto"],[1,"default-item-table"],["rowspan","2",1,"text-center"],["colspan","2"],[1,"text-center"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"px-2"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-form-field",3)(4,"mat-icon",4),e._uU(5,"search"),e.qZA(),e.TgZ(6,"input",5),e.NdJ("keyup.enter",function(c){return o.onSearch(c.target.value)}),e.qZA()()(),e.TgZ(7,"div")(8,"button",6),e.NdJ("click",function(){return o.onDownload()}),e._UZ(9,"mat-icon",7),e.TgZ(10,"span",8),e._uU(11,"Download Template"),e.qZA()()(),e.TgZ(12,"div",9)(13,"button",6),e.NdJ("click",function(){return o.onImport()}),e._UZ(14,"mat-icon",7),e.TgZ(15,"span",8),e._uU(16,"Import"),e.qZA()()()(),e.TgZ(17,"table",10)(18,"thead")(19,"tr")(20,"th",11),e._uU(21,"NO"),e.qZA(),e.TgZ(22,"th",12),e._uU(23,"Enterprise Reliability Test Procedures"),e.qZA(),e.TgZ(24,"th",13),e._uU(25,"\u4eba\u529b\u5de5\u6642"),e.qZA(),e.TgZ(26,"th",13),e._uU(27,"\u8a2d\u5099\u5de5\u6642"),e.qZA()(),e.TgZ(28,"tr")(29,"th"),e._uU(30,"Item No"),e.qZA(),e.TgZ(31,"th"),e._uU(32,"Minotaur SOW"),e.qZA(),e.TgZ(33,"th",13),e._uU(34,"(hr)"),e.qZA(),e.TgZ(35,"th",13),e._uU(36,"(hr)"),e.qZA()()(),e.YNc(37,Oe,2,1,"tbody",14),e.qZA()()),2&t&&(e.xp6(6),e.Q6J("autocomplete","off")("placeholder","Search..."),e.xp6(2),e.Q6J("color","basic"),e.xp6(1),e.Q6J("svgIcon","heroicons_outline:arrow-down-tray"),e.xp6(4),e.Q6J("color","basic"),e.xp6(1),e.Q6J("svgIcon","heroicons_outline:arrow-up-tray"),e.xp6(23),e.Q6J("ngIf",o.page.data))},dependencies:[v.lW,b.KE,b.qo,y.Hw,D.Nt,g.sg,g.O5],styles:["table.default-item-table{width:100%;table-layout:auto;border-left-width:1px;--tw-border-opacity: 1;border-color:rgb(100 116 139 / var(--tw-border-opacity));border-collapse:separate;border-spacing:0}table.default-item-table thead{position:sticky;top:0;--tw-bg-opacity: 1;background-color:rgb(248 250 252 / var(--tw-bg-opacity))}table.default-item-table th{border-right-width:1px;border-bottom-width:1px;--tw-border-opacity: 1;border-color:rgb(100 116 139 / var(--tw-border-opacity));padding:.125rem}table.default-item-table tr:first-child th{border-top-width:1px}table.default-item-table td{border-bottom-width:1px;border-right-width:1px;--tw-border-opacity: 1;border-color:rgb(100 116 139 / var(--tw-border-opacity));padding:.125rem}table.default-item-table td .checkbox{margin-top:.25rem;height:1rem;width:1rem}table.default-item-table .edit{width:4.5rem;white-space:nowrap;--tw-bg-opacity: 1;background-color:rgb(219 234 254 / var(--tw-bg-opacity));text-align:center}table.default-item-table .edit input{width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-align:center}table.default-item-table .view{text-align:center}\n"],encapsulation:2,changeDetection:0}),i})();const Ne=["drawer"],Me=function(i,a){return{"text-hint":i,"text-primary dark:text-primary-500":a}},Be=function(i){return{"text-primary dark:text-primary-500":i}};function Ee(i,a){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",19),e.NdJ("click",function(){const c=e.CHM(t).$implicit,n=e.oxw();return e.KtG(n.goToPanel(c.id))}),e._UZ(2,"mat-icon",20),e.TgZ(3,"div",21)(4,"div",22),e._uU(5),e.qZA(),e.TgZ(6,"div",23),e._uU(7),e.qZA()()(),e.BQk()}if(2&i){const t=a.$implicit,o=e.oxw();e.xp6(2),e.Q6J("ngClass",e.WLB(5,Me,!o.selectedPanel||o.selectedPanel!==t.id,o.selectedPanel&&o.selectedPanel===t.id))("svgIcon",t.icon),e.xp6(2),e.Q6J("ngClass",e.VKq(8,Be,o.selectedPanel&&o.selectedPanel===t.id)),e.xp6(1),e.hij(" ",t.title," "),e.xp6(2),e.hij(" ",t.description," ")}}function Ye(i,a){1&i&&(e.ynx(0),e._UZ(1,"default-items"),e.BQk())}function Ge(i,a){1&i&&(e.ynx(0),e._UZ(1,"test-fee"),e.BQk())}function Pe(i,a){1&i&&(e.ynx(0),e._UZ(1,"settings-account"),e.BQk())}let ze=(()=>{class i{constructor(t,o){this._changeDetectorRef=t,this._fuseMediaWatcherService=o,this.drawerMode="side",this.drawerOpened=!0,this.panels=[],this.selectedPanel="default-items",this._unsubscribeAll=new A.x}ngOnInit(){this.panels=[{id:"default-items",icon:"",title:"\u4eba\u529b\u8a2d\u5099\u5de5\u6642",description:""},{id:"test-fee",title:"3rd party Test fee"},{id:"recovery",title:"\u8cc7\u6599\u6062\u5fa9"},{id:"account",title:"\u5e33\u865f\u7ba1\u7406"}],this._fuseMediaWatcherService.onMediaChange$.pipe((0,T.R)(this._unsubscribeAll)).subscribe(({matchingAliases:t})=>{t.includes("lg")?(this.drawerMode="side",this.drawerOpened=!0):(this.drawerMode="over",this.drawerOpened=!1),this._changeDetectorRef.markForCheck()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}goToPanel(t){this.selectedPanel=t,"over"===this.drawerMode&&this.drawer.close()}getPanelInfo(t){return this.panels.find(o=>o.id===t)}trackByFn(t,o){return o.id||t}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO),e.Y36(ae.T))},i.\u0275cmp=e.Xpm({type:i,selectors:[["settings"]],viewQuery:function(t,o){if(1&t&&e.Gf(Ne,5),2&t){let r;e.iGM(r=e.CRH())&&(o.drawer=r.first)}},decls:23,vars:12,consts:[[1,"flex","flex-col","w-full","min-w-0","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"flex-auto","sm:h-full"],[1,"w-full","sm:w-96","dark:bg-gray-900","border-0",3,"autoFocus","mode","opened"],["drawer",""],[1,"flex","items-center","justify-between","m-8","mr-6","sm:my-10"],[1,"text-4xl","font-extrabold","tracking-tight","leading-none"],[1,"lg:hidden"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"flex","flex-col"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","flex-col","bg-card"],[1,"absolute","inset-0","flex","flex-auto","flex-col","min-w-0"],[1,"flex","items-center","px-6","pt-9"],["mat-icon-button","",1,"lg:hidden","-ml-2",3,"click"],[1,"ml-2","lg:ml-0","text-3xl","font-bold","tracking-tight","leading-none"],["cdkScrollable","",1,"mt-8","px-6","pb-12","overflow-y-auto"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"flex","px-8","py-5","cursor-pointer",3,"click"],[3,"ngClass","svgIcon"],[1,"ml-3"],[1,"font-medium","leading-6",3,"ngClass"],[1,"mt-0.5","text-secondary"]],template:function(t,o){if(1&t){const r=e.EpF();e.TgZ(0,"div",0)(1,"mat-drawer-container",1)(2,"mat-drawer",2,3)(4,"div",4),e._UZ(5,"div",5),e.TgZ(6,"div",6)(7,"button",7),e.NdJ("click",function(){e.CHM(r);const n=e.MAs(3);return e.KtG(n.close())}),e._UZ(8,"mat-icon",8),e.qZA()()(),e.TgZ(9,"div",9),e.YNc(10,Ee,8,10,"ng-container",10),e.qZA()(),e.TgZ(11,"mat-drawer-content",11)(12,"div",12)(13,"div",13)(14,"button",14),e.NdJ("click",function(){e.CHM(r);const n=e.MAs(3);return e.KtG(n.toggle())}),e._UZ(15,"mat-icon",8),e.qZA(),e.TgZ(16,"div",15),e._uU(17),e.qZA()(),e.TgZ(18,"div",16),e.ynx(19,17),e.YNc(20,Ye,2,0,"ng-container",18),e.YNc(21,Ge,2,0,"ng-container",18),e.YNc(22,Pe,2,0,"ng-container",18),e.BQk(),e.qZA()()()()()}2&t&&(e.xp6(2),e.Q6J("autoFocus",!1)("mode",o.drawerMode)("opened",o.drawerOpened),e.xp6(6),e.Q6J("svgIcon","heroicons_outline:x"),e.xp6(2),e.Q6J("ngForOf",o.panels)("ngForTrackBy",o.trackByFn),e.xp6(5),e.Q6J("svgIcon","heroicons_outline:menu"),e.xp6(2),e.hij(" ",o.getPanelInfo(o.selectedPanel).title," "),e.xp6(2),e.Q6J("ngSwitch",o.selectedPanel),e.xp6(1),e.Q6J("ngSwitchCase","default-items"),e.xp6(1),e.Q6J("ngSwitchCase","test-fee"),e.xp6(1),e.Q6J("ngSwitchCase","account"))},dependencies:[v.RK,y.Hw,ne.PQ,C.jA,C.kh,C.LW,g.mk,g.sg,g.RF,g.n9,we,Fe,Qe],encapsulation:2,changeDetection:0}),i})(),je=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[E.Bz.forChild([{path:"",component:ze}]),v.ot,b.lN,y.Ps,D.c,te,R.LD,C.SJ,oe.rP,k.Is,ie.fC,re.m]}),i})()}}]);