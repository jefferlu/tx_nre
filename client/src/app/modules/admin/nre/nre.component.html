<div class="absolute inset-0 flex flex-col min-w-0 overflow-y-auto" cdkScrollable>

    <div class="flex flex-col w-full py-2 sm:pt-10 max-w-xs sm:max-w-6xl mx-auto">
        <form [formGroup]="form" class="flex flex-col sm:flex-row items-center justify-between w-full max-w-xs sm:max-w-none">

            <!-- Customer -->
            <mat-form-field class="w-full sm:w-40 fuse-mat-dense">
                <mat-select [placeholder]="'Customer'" [formControlName]="'customer'">
                    <ng-container *ngFor="let cust of customers;let idx=index">
                        <mat-option [value]="idx">{{cust.name}}</mat-option>
                    </ng-container>
                </mat-select>
                <mat-icon matPrefix fontSet="material-icons-outlined">supervisor_account</mat-icon>
            </mat-form-field>

            <!-- Project -->
            <mat-form-field class="w-full sm:w-72 mt-4 sm:mt-0 sm:ml-4 fuse-mat-dense">
                <mat-icon matPrefix fontSet="material-icons-outlined">business_center</mat-icon>
                <input type="search" matInput [formControlName]="'project'" [autocomplete]="'off'" [placeholder]="'Project'">
                <mat-error *ngIf="form.get('project').hasError('required')">
                    Project is required
                </mat-error>
                <mat-error *ngIf="form.get('project').hasError('invalidName')">
                    Special characters are not allowed!
                </mat-error>
            </mat-form-field>


            <!-- Search button -->
            <button class="ml-auto sm:ml-4 mt-4 sm:-mt-5 bg-accent" mat-flat-button [color]="'primary'" (click)="onSearch()">
                <mat-icon [svgIcon]="'heroicons_solid:search'"></mat-icon>
                <span class="ml-2 mr-1">Search</span>
            </button>

            <!-- Power Ratio -->
            <mat-form-field class="w-full sm:w-48 mt-4 sm:mt-0 sm:ml-auto fuse-mat-dense">
                <mat-icon matPrefix fontSet="material-icons-outlined">bolt</mat-icon>
                <input type="number" min="0" matInput [formControlName]="'power_ratio'" [autocomplete]="'off'" [placeholder]="'Power Ratio'">
                <span matSuffix class="ml-2">W</span>
            </mat-form-field>

            <!-- Save button-->
            <button class="ml-auto sm:ml-4 mt-4 sm:-mt-5" mat-flat-button [color]="'primary'" (click)="save()">
                <mat-icon fontIcon="save"></mat-icon>
                <span class="ml-2 mr-1">Save</span>
            </button>
        </form>
    </div>

    <div class="flex flex-auto">
        <div class="flex flex-col flex-auto w-full mx-auto">

            <ng-container *ngIf="data">

                <!-- Project and Status -->
                <div class="flex flex-col sm:flex-row sm:items-center min-w-0 px-6 pb-3 sm:px-8">
                    <div class="flex">
                        <mat-icon class="icon-size-8" fontSet="material-icons-outlined">business_center</mat-icon>
                        <div class="text-2xl font-semibold tracking-tight leading-7 md:leading-snug ml-2 sm:mt-1">{{project.name}}</div>
                    </div>


                    <ng-container *ngIf="project.power_ratio">
                        <div class="flex sm:ml-5">
                            <mat-icon class="icon-size-8" fontSet="material-icons-outlined">bolt</mat-icon>
                            <div class="text-2xl font-semibold tracking-tight leading-7 md:leading-snug sm:mt-1">{{project.power_ratio}} (W)</div>
                        </div>

                    </ng-container>

                    <div class="flex min-w-0 sm:ml-2">
                        <div *ngIf="status.label" class="flex items-end ml-4 py-1 px-3 rounded-full leading-normal sm:mt-1"
                            [ngClass]="'text-'+status.color+'-600 bg-'+status.color+'-100'">
                            <span class="text-sm font-medium whitespace-nowrap">{{status.label}}</span>
                        </div>
                    </div>

                    <div class="ml-auto">
                        <button *ngIf="tab.index==1" class="ml-auto sm:ml-4 mt-4 sm:-mt-5 text-green-600" mat-flat-button (click)="onExport()">
                            <mat-icon [svgIcon]="'heroicons_solid:arrow-down-tray'"></mat-icon>
                            <span class="ml-2 mr-1">Export</span>
                        </button>
                    </div>

                </div>

                <mat-tab-group class="sm:px-2" mat-stretch-tabs="false" [animationDuration]="'0'" [(selectedIndex)]="tab.index">

                    <mat-tab label="User Input">
                        <ng-template matTabContent>
                            <div class="relative overflow-x-auto">

                                <table class="table-auto w-full border-2 border-slate-500 cust-table">

                                    <thead>
                                        <tr>
                                            <th colspan="17">Reliability/S&V Test</th>
                                        </tr>
                                        <tr>
                                            <th rowspan="2">Function</th>
                                            <th rowspan="2">Test Item</th>
                                            <th colspan="3">Concept</th>
                                            <th colspan="3">BU</th>
                                            <th colspan="3">CT</th>
                                            <th colspan="3">NT</th>
                                            <th colspan="3">OT</th>
                                        </tr>

                                        <tr>
                                            <th>Test UUT</th>
                                            <th>Need Test</th>
                                            <th>Regression Rate</th>

                                            <th>Test UUT</th>
                                            <th>Need Test</th>
                                            <th>Regression Rate</th>

                                            <th>Test UUT</th>
                                            <th>Need Test</th>
                                            <th>Regression Rate</th>

                                            <th>Test UUT</th>
                                            <th>Need Test</th>
                                            <th>Regression Rate</th>

                                            <th>Test UUT</th>
                                            <th>Need Test</th>
                                            <th>Regression Rate</th>
                                        </tr>

                                    </thead>
                                    <tbody>
                                        <ng-container *ngFor="let func of data?.functions">
                                            <ng-container *ngFor="let item of func.test_items;let idx=index">

                                                <tr *ngIf="idx==0">
                                                    <td class="text-center" [rowSpan]="func.test_items?.length">{{func.name}}</td>
                                                    <td>{{item.name}}</td>
                                                    <ng-container *ngFor="let n of ['concept','bu','ct','nt','ot']">
                                                        <td class="edit"><input [(ngModel)]="item.record[n + '_test_uut']"
                                                                (change)="change()" numeric-only>
                                                        </td>
                                                        <td class="edit"><input type="checkbox" class="hover:cursor-pointer"
                                                                [(ngModel)]="item.record[n + '_need_test']" (change)="change()"></td>
                                                        <td class="edit"><input [(ngModel)]="item.record[n + '_regression_rate']"
                                                                (change)="change()" numeric-two-digit></td>
                                                    </ng-container>
                                                </tr>

                                                <tr *ngIf="idx>0">
                                                    <td>{{item.name}}</td>
                                                    <ng-container *ngFor="let n of ['concept','bu','ct','nt','ot']">
                                                        <td class="edit"><input [(ngModel)]="item.record[n + '_test_uut']"
                                                                (change)="change()" numeric-only>
                                                        </td>
                                                        <td class="edit"><input type="checkbox" class="hover:cursor-pointer"
                                                                [(ngModel)]="item.record[n + '_need_test']" (change)="change()"></td>
                                                        <td class="edit"><input [(ngModel)]="item.record[n + '_regression_rate']"
                                                                (change)="change()" numeric-two-digit></td>
                                                    </ng-container>
                                                </tr>

                                            </ng-container>
                                            <tr>

                                            </tr>
                                        </ng-container>




                                        <!-- <tr>
                                    <td class="text-center" rowspan="3">Reliability</td>
                                    <td>REL0973 Baseline</td>
                                    <td class="edit">
                                        <input type="number">
                                    </td>
                                    <td class="edit">
                                        <input type="checkbox">
                                    </td>
                                    <td class="edit">
                                        <input type="number">
                                    </td>
                                </tr>

                                <tr>
                                    <td>REL0978 Input Power Cycle</td>
                                    <td class="edit">
                                        <input type="number">
                                    </td>
                                    <td class="edit">
                                        <input type="checkbox">
                                    </td>
                                    <td class="edit">
                                        <input type="number">
                                    </td>
                                </tr>
                                <tr>
                                    <td>REL0983 System Restart</td>
                                </tr>


                                <tr>
                                    <td class="text-center" rowspan="3">S&V</td>
                                    <td>SV0102 Enterprise Non-Operational Random Vibration Test Procedure</td>
                                </tr>
                                <tr>
                                    <td>SV0105 Enterprise Operational Random Vibration Test Procedure</td>
                                </tr>
                                <tr>
                                    <td>SV0106 Enterprise Non-Operational Half Sine Shock Test Procedure</td>
                                </tr> -->

                                    </tbody>

                                </table>
                            </div>
                        </ng-template>



                    </mat-tab>

                    <mat-tab label="Equipment">
                        <ng-template matTabContent>

                            <div class="relative overflow-x-auto">
                                <table class="table-auto w-full border-2 border-slate-500 cust-table">
                                    <thead>
                                        <tr>
                                            <th colspan="10">Reliability/S&V Test</th>
                                        </tr>
                                        <tr>
                                            <th>Function</th>
                                            <th>Test Item</th>
                                            <th>Lab Location</th>
                                            <th>Lab Rate</th>
                                            <th>Concept</th>
                                            <th>BU</th>
                                            <th>CT</th>
                                            <th>NT</th>
                                            <th>OT</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        <!-- <tr>
                                            <td class="text-center" rowspan="2">Reliability</td>
                                            <td>REL0973 Baseline</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>                                            
                                            <td>REL0973 Baseline</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr> -->

                                        <ng-container *ngFor="let func of data?.functions">
                                            <ng-container *ngFor="let item of func.test_items;let idx=index">
                                                <tr *ngIf="idx==0">
                                                    <td class="text-center" [rowSpan]="func.test_items?.length">{{func.name}}</td>
                                                    <td>{{item.name}}</td>
                                                    <ng-container *ngFor="let n of ['lab_location','lab_rate','concept','bu','ct','nt','ot']">
                                                        <td class="view"></td>
                                                    </ng-container>
                                                </tr>
                                                <tr *ngIf="idx>0">
                                                    <td>{{item.name}}</td>
                                                    <ng-container *ngFor="let n of ['lab_location','lab_rate','concept','bu','ct','nt','ot']">
                                                        <td class="view"></td>
                                                    </ng-container>
                                                </tr>
                                            </ng-container>
                                        </ng-container>
                                    </tbody>
                                </table>
                            </div>

                        </ng-template>
                    </mat-tab>

                    <mat-tab label="Man Power">
                        <ng-template matTabContent>
                            <div class="relative flex flex-col w-full max-w-xs sm:max-w-3xl mx-auto overflow-x-auto">
                                <table class="table-auto w-full border-2 border-slate-500 cust-table">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Concept</th>
                                            <th>BU (hrs)</th>
                                            <th>CT (hrs)</th>
                                            <th>NT (hrs)</th>
                                            <th>OT (hrs)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <ng-container *ngFor="let func of data?.functions">
                                            <tr>
                                                <td class="view">{{func.name}}</td>
                                                <td class="view"></td>
                                                <td class="view"></td>
                                                <td class="view"></td>
                                                <td class="view"></td>
                                                <td class="view"></td>
                                            </tr>
                                        </ng-container>
                                    </tbody>
                                </table>
                            </div>
                        </ng-template>
                    </mat-tab>

                </mat-tab-group>
            </ng-container>

            <div class="flex flex-auto flex-col items-center justify-center dark:bg-transparent" *ngIf="!data">
                <!-- <mat-icon class="icon-size-24" [svgIcon]="'heroicons_outline:document-search'"></mat-icon> -->
                <mat-icon matPrefix fontSet="material-icons-outlined" class="text-slate-500 icon-size-24">content_paste_search</mat-icon>
                <div class="mt-6 text-2xl font-semibold tracking-tight text-slate-500"></div>
            </div>
        </div>
    </div>
</div>